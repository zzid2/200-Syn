
## åˆ›å»ºâ€œ20-Synâ€ä»“åº“--->>æ­¤ä»“åº“â€œç»‘å®šACCESS_TOKENä»¤ç‰Œå€¼â€--->>æ·»åŠ "å·¥ä½œæµæ‰§è¡Œæƒé™"--->>æ‰‹åŠ¨åˆ›å»ºâ€œGitHub Actionsâ€å·¥ä½œæµ--->>ä¸Šä¼ æ‰€æœ‰æºç ã€‚
## åˆ›å»ºâ€œluci-appâ€ä»“åº“--->>ä¸Šä¼ ä»»æ„æºç æ–‡ä»¶ã€‚
## é¦–å…ˆæ‰‹åŠ¨è¿è¡Œä¸€æ¬¡â€œ20-Synâ€å·¥ä½œæµã€‚


name: Package                                          ## Actionså·¥ä½œæµçš„åç§°
on:
  workflow_dispatch:                                   ## å·¥ä½œæµç¨‹_è°ƒåº¦
    inputs:
      ssh:                                             ## åšåˆ¤æ–­æ—¶ç”¨çš„IDåç§°ï¼ˆå¯æ›´æ”¹ï¼‰  
        description: 'SSHè¿œç¨‹'                         ## å·¥ä½œæµ_èœå•æç¤ºæ¡†çš„åç§°
        required: false                                ## æ˜¯å¦ å¿…é€‰é¡¹ï¼ˆå¦ï¼‰
        default: 'false'                               ## è¾“å…¥ï¼štrue=å¼€å¯ false=å…³é—­
        type: boolean                                  ## å°†ç±»å‹è®¾ç½®ä¸ºå¸ƒå°”ç±»å‹ï¼ˆå¤é€‰æ¡†ï¼‰
      release:                                         ## åšåˆ¤æ–­æ—¶ç”¨çš„IDåç§°ï¼ˆå¯æ›´æ”¹ï¼‰  
        description: 'å‘å¸ƒæ ‡ç­¾'                        ## å·¥ä½œæµ_èœå•æç¤ºæ¡†çš„åç§°
        required: false                                ## æ˜¯å¦ å¿…é€‰é¡¹ï¼ˆå¦ï¼‰
        default: 'true'                                ## é»˜è®¤å€¼
        type: boolean                                  ## å°†ç±»å‹è®¾ç½®ä¸ºå¸ƒå°”ç±»å‹ï¼ˆå¤é€‰æ¡†ï¼‰
        
        
  # repository_dispatch:                                 ## æ¥æ”¶å¤–éƒ¨äº‹ä»¶è§¦å‘
  schedule:                                            ## å®šæ—¶è§¦å‘å¼€å§‹ç¼–è¯‘(æ—¶é—´è®¾ç½®è¯·çœ‹å®šæ—¶ç¼–è¯‘è¯´æ˜)
    - cron: 0 */6 * * *                                ## æ¯éš”6ä¸ªå°æ—¶è¿è¡Œä¸€æ¬¡
    
    
  push:                                                ## ä¿®æ”¹ä»»æ„ä»£ç ï¼ˆæˆ–æŒ‡å®šæ–‡ä»¶ï¼‰ è§¦å‘ç¼–è¯‘
    branches:
      - main                                           ## ç¡®ä¿åªåœ¨ main åˆ†æ”¯æœ‰æ”¹åŠ¨æ—¶ï¼Œè§¦å‘ç¼–è¯‘
    paths:                                             ## å½“æŒ‡å®šæ–‡ä»¶â€œä¿®æ”¹å˜åŠ¨æ—¶â€ è§¦å‘ç¼–è¯‘
      - '.github/workflows/package.yml'                ## é»˜è®¤æ˜¯"package.yml"æ–‡ä»¶å˜åŠ¨æ—¶ è§¦å‘ç¼–è¯‘
      - 'package.sh'                                   ## é»˜è®¤æ˜¯"package.sh"æ–‡ä»¶å˜åŠ¨æ—¶  è§¦å‘ç¼–è¯‘
      
      
env:                                                   ## å…¨å±€å˜é‡å®šä¹‰
  Run_number: ${{github.run_number}}                   ## å½“å‰è¿è¡Œå·¥ä½œæµç¼–å·ï¼Œå¦‚#12
  CangKu_URL: 'https://github.com/zzid2/luci-app-200.git'  ## æ¨é€ä»“åº“_luci-app-20.git   luci-app-200.git
  REPO_BRANCH: main                                    ## æ¨é€åˆ†æ”¯_ä¸»åˆ†æ”¯
  REPO_FORMER: former                                  ## æ¨é€åˆ†æ”¯_æ—§ç‰ˆåˆ åº“åˆ†æ”¯
  TZ: Asia/Shanghai                                    ## æ—¶åŒºè®¾ç½®ä¸ºä¸Šæµ·
  
  
jobs:
  build-luci-app:                                      ## æ­¤è„šæœ¬çš„ä»»åŠ¡åç§°ï¼ˆå¯è‡ªå®šä¹‰ï¼‰
    runs-on: ubuntu-latest                             ## ä½¿ç”¨ubuntu-æœ€æ–°ç‰ˆ
    if: github.event.repository.owner.id == github.event.sender.id || ! github.event.sender.id     ## åªæœ‰ä»“åº“æ‰€æœ‰è€…æ‰èƒ½ä½¿ç”¨  â€œç‚¹ Starå¯åŠ¨ç¼–è¯‘â€
    
    
    name: æ›´æ–°Package                                  ## è¿è¡Œå·¥ä½œæµçš„åç§° Update openwrt-packages
    strategy:
      fail-fast: false
      matrix:
        target: [package]                              ## å¹¶è¡Œè¿è¡Œå¤šä»»åŠ¡
        
    steps:
    
    
    - name: å‡†å¤‡ç¯å¢ƒ                                   ## Checkout 
      uses: actions/checkout@v4
      with:
        fetch-depth: 0
        
        
        
    - name: å®‰è£…ç¼–è¯‘ç¯å¢ƒ                               ## Initialization environment
      run : |
        pwd && ls
        
        AUTHOR_ID=$(echo $CangKu_URL | awk -F'/' '{print $(NF-1)}')                                ## ä½œè€…IDï¼Œå¦‚ï¼šzzid2
        echo "AUTHOR_ID=$AUTHOR_ID" >> $GITHUB_ENV                                                 ## ä½œè€…IDï¼Œå†™å…¥åˆ°å˜é‡ä¸­
        
        CangKu_ID=$(echo $CangKu_URL | awk -F'/' '{print $NF}' | sed 's/.git//')                   ## é¡¹ç›®IDï¼Œå¦‚ï¼š120
        echo "CangKu_ID=$CangKu_ID" >> $GITHUB_ENV                                                 ## é¡¹ç›®IDï¼Œå†™å…¥åˆ°å˜é‡ä¸­
        
        CangKu=$(echo "${GITHUB_REPOSITORY}" | cut -d'/' -f2)                                      ## ä»“åº“çš„åç§° å¦‚ï¼š20-Syn
        echo "CangKu=${CangKu}" >> $GITHUB_ENV                                                     ## ä»“åº“çš„åç§° å†™å…¥åˆ°å˜é‡ä¸­
        
        ## æ—¶é—´çš„å˜é‡
        echo "date=$(date "+%Y.%m.%d-%H%M")" >> $GITHUB_ENV                                        ## æ ‡ç­¾æ—¶é—´æ ¼å¼ï¼š2024.01.02.1310
        echo "date1=$(date "+%Yå¹´%mæœˆ%då·-%Hç‚¹%Måˆ†")" >> $GITHUB_ENV                              ## æ—¶é—´å˜é‡æ ¼å¼: 2021å¹´01æœˆ02å·-13ç‚¹10åˆ†
        echo "date2=$(date +'%m.%d')" >> $GITHUB_ENV                                               ## æ—¶é—´å˜é‡æ ¼å¼ï¼š08.01
        echo "$(date +%s)" > start_time.txt                                                        ## å¯åŠ¨æ—¶é—´ å†™å…¥åˆ°â€œstart_time.txtâ€æ–‡æœ¬ä¸­ï¼ˆä¸ç»“å°¾â€œend_time.txtâ€æ–‡æœ¬å¯¹åº”ï¼‰
        
        git config --global user.name "actions-user"                                               ## æäº¤åç§°
        git config --global user.email "$AUTHOR_ID@users.noreply.github.com"                       ## æäº¤Githubä»“åº“çš„ç”µå­é‚®ä»¶åœ°å€ï¼ˆé»˜è®¤è‡ªå·±ä»“åº“ï¼‰
        sudo timedatectl set-timezone "$TZ"                                                        ## è®¾ç½®æ—¶åŒºä¸ºä¸Šæµ·
        
        ## ç»ˆç«¯æ·»åŠ ä¸­æ–‡
        sudo apt-get install -y language-pack-zh-hans                                              ## å®‰è£…ä¸­æ–‡è¯­è¨€åŒ…
        echo "LANG=zh_CN.UTF-8" >> $GITHUB_ENV                                                     ## åŠ å…¥ä¸­æ–‡è¯­è¨€åŒ… çš„å˜é‡ï¼Œä¼šæŒç»­æ˜¾ç¤ºä¸­æ–‡è¯­è¨€ï¼›
        
        
        
    - name: SSHé“¾æ¥ï¼ˆåˆ°æ­¤é¢„è®¡10åˆ†é’Ÿï¼‰                  ## SSH connection to Actions
      uses: P3TERX/ssh2actions@v1.0.0
      if: github.event.inputs.ssh == 'true'
      env:
        TELEGRAM_CHAT_ID: ${{ secrets.TELEGRAM_CHAT_ID }}
        TELEGRAM_BOT_TOKEN: ${{ secrets.TELEGRAM_BOT_TOKEN }}
        
        
        
    - name: ä¸‹è½½ former åˆ†æ”¯                           ## Clone packages
      run: |
        # pwd && ls
        
        git clone -b $REPO_FORMER $CangKu_URL $REPO_FORMER || {                                    ## å…‹éš† former åˆ†æ”¯ï¼Œå¦‚æœå…‹éš†è¿œç¨‹ä»“åº“å¤±è´¥ï¼Œæœ¬åœ°åˆ›å»ºæ–°ä»“åº“ã€‚
            echo "å…‹éš†è¿œç¨‹ä»“åº“å¤±è´¥ï¼Œæœ¬åœ°åˆ›å»ºæ–°ä»“åº“ï¼ï¼ï¼";
            mkdir $REPO_FORMER;                                                                    ## åˆ›å»º formerç›®å½•
            cd $REPO_FORMER;                                                                       ## cd è¿›å…¥ç›®å½•
            git init;                                                                              ## åˆå§‹åŒ–æ–°ä»“åº“
            git branch -M $REPO_FORMER;                                                            ## é‡å‘½åé»˜è®¤åˆ†æ”¯ä¸º "former"
            cd ..;                                                                                 ## è¿”å›ä¸Šçº§ç›®å½•
        }
        
        cd $REPO_FORMER                                                                            ## è¿›å…¥ formerç›®å½•
        
        # rm -rf {LICENSE,README,README.md,README_en.md}
        # rm -rf ./*/{LICENSE,README,README.md,README_en.md}
        # rm -rf ./*/*/{LICENSE,README,README.md,README_en.md}
        
        git rm -r --cache * >/dev/null 2>&1 &                                                      ## åˆ é™¤ Gitç´¢å¼•ï¼ˆç¼“å­˜åŒºï¼‰ä¸­æ‰€æœ‰æ–‡ä»¶å’Œç›®å½•ï¼Œä½†ä¿ç•™æºç æ–‡ä»¶ï¼›
        
        echo "è¿™æ˜¯ä¸€ä¸ªå­˜æ”¾åˆ åº“çš„ç›®å½•" > former.txt
        
        
        
    - name: ä¸‹è½½ main åˆ†æ”¯                             ## Clone packages
      run: |
        # pwd && ls
        
        git clone -b $REPO_BRANCH $CangKu_URL $REPO_BRANCH || {                                    ## å…‹éš† main åˆ†æ”¯ï¼Œå¦‚æœå…‹éš†è¿œç¨‹ä»“åº“å¤±è´¥ï¼Œæœ¬åœ°åˆ›å»ºæ–°ä»“åº“ã€‚
            echo "å…‹éš†è¿œç¨‹ä»“åº“å¤±è´¥ï¼Œæœ¬åœ°åˆ›å»ºæ–°ä»“åº“ï¼ï¼ï¼";
            mkdir $REPO_BRANCH;
            cd $REPO_BRANCH;
            git init;
            git branch -M $REPO_BRANCH;
            cd ..;
        }
        
        
        ## æ¯”è¾ƒmainå’Œformerç›®å½•ï¼Œåœ¨é‡å¤çš„formerå­ç›®å½•åè¿½åŠ åç¼€ï¼›
        for item in $REPO_BRANCH/*; do                                                                                ## éå† main ç›®å½•å†…æ‰€æœ‰æ–‡ä»¶ç›®å½•ï¼Œ
            if [[ "$(basename "$item")" != ".git" && -e "$REPO_FORMER/$(basename "$item")" ]]; then                   ## åˆ¤æ–­ former ç›®å½•å†…ï¼ˆæ’é™¤.gitç›®å½•ï¼‰ æ˜¯å¦æœ‰ä¸mainç›®å½•å†…é‡å¤çš„ï¼ˆå­ç›®å½•ï¼‰ï¼Œ
                mv "$REPO_FORMER/$(basename "$item")" "$REPO_FORMER/$(basename "$item")_bak_${{ env.date2 }}"         ## é‡å‘½å former ç›®å½•å†…é‡å¤çš„å­ç›®å½•ï¼Œè¿½åŠ åç¼€åï¼›
                echo "é‡å‘½åé‡å¤é¡¹: $REPO_FORMER/$(basename "$item") ä¸º $REPO_FORMER/$(basename "$item")_bak_${{ env.date2 }}"
            fi
        done
        
        
        rsync -av --exclude='.git' $REPO_BRANCH/ $REPO_FORMER/                                     ## åŒæ­¥ å¤åˆ¶â€œmainâ€ç›®å½•å†…æ–‡ä»¶ åˆ°â€œformerâ€ç›®å½•å†…ï¼Œå¹¶æ’é™¤ .gitç›®å½•
        
        
        chmod +x build/${{matrix.target}}.sh                                                       ## å¢åŠ  â€œbuild/main.shâ€è„šæœ¬å¯æ‰§è¡Œæƒé™
        cd $REPO_BRANCH                                                                            ## cd è¿›å…¥ main ç›®å½•
        
        
        # rm -rf {LICENSE,README,README.md,README_en.md}
        # rm -rf ./*/{LICENSE,README,README.md,README_en.md}
        # rm -rf ./*/*/{LICENSE,README,README.md,README_en.md}                                       ## åˆ é™¤æ— ç”¨è¯´æ˜
        
        git rm -r --cache * >/dev/null 2>&1 &                                                      ## åˆ é™¤ Gitç´¢å¼•ï¼ˆç¼“å­˜åŒºï¼‰ä¸­æ‰€æœ‰æ–‡ä»¶å’Œç›®å½•ï¼Œä½†ä¿ç•™æºç æ–‡ä»¶ï¼›
        
        rm -rf `find ./* -maxdepth 0 -type d ! -name "build"` >/dev/null 2>&1                      ## åˆ é™¤ å½“å‰ç›®å½•å†…æ‰€æœ‰æ–‡ä»¶ï¼Œä½†æ’é™¤"build"ç›®å½•ï¼›
        
        
        
        ## ç¬¬äºŒæ¬¡å•ç‹¬ä¸‹è½½æœ€æ–°ç‰ˆæ’ä»¶
        bash /$GITHUB_WORKSPACE/build/${{matrix.target}}.sh                                        ## æ‰§è¡Œmain.sh       é‡æ–°å…‹éš†ä¸€é æœ€æ–°ç‰ˆçš„æ’ä»¶ï¼ï¼ï¼
        # bash /$GITHUB_WORKSPACE/build/convert_translation.sh                                       ## æ‰§è¡Œconvert_translation.sh  å…¨éƒ¨æ”¹æˆzh-cnä¸­æ–‡
        bash /$GITHUB_WORKSPACE/build/create_acl_for_luci.sh -a                                    ## æ‰§è¡Œcreate_acl_for_luci.sh  è¾“å…¥æŠ¥é”™æç¤º
        bash /$GITHUB_WORKSPACE/build/Modify.sh                                                    ## æ‰§è¡ŒModify.sh    åˆ é™¤æ’ä»¶åŒ…å†…ï¼ˆ.git .svn ç­‰å¤šä½™çš„æ–‡ä»¶ï¼‰
        
        
        # rm -rf {LICENSE,README,README.md,README_en.md}
        # rm -rf ./*/{LICENSE,README,README.md,README_en.md}
        # rm -rf ./*/*/{LICENSE,README,README.md,README_en.md}                                       ## åˆ é™¤æ— ç”¨è¯´æ˜
        
        
        
    - name: æ•´ç†é‡å¤å­ç›®å½•
      run: |
        
        for item in $REPO_BRANCH/*; do                                                                                 ## éå† main ç›®å½•å†…æ‰€æœ‰æ–‡ä»¶ç›®å½•ï¼Œ
            if [[ "$(basename "$item")" != ".git" && -e "$REPO_FORMER/$(basename "$item")" ]]; then                    ## åˆ¤æ–­ former ç›®å½•å†…ï¼ˆæ’é™¤.gitç›®å½•ï¼‰ æ˜¯å¦æœ‰ä¸mainç›®å½•å†…é‡å¤çš„ï¼ˆå­ç›®å½•ï¼‰ï¼Œ
            rm -rf "$REPO_FORMER/$(basename "$item")"                                                                  ## åˆ é™¤ former ç›®å½•å†…é‡å¤çš„å­ç›®å½•ï¼›
            echo "åˆ é™¤é‡å¤é¡¹: $REPO_FORMER/$(basename "$item")"
            fi
        done
        
        
        mkdir -p packages                                                                                              ## åˆ›å»ºâ€œpackagesâ€ç›®å½•ï¼Œç”¨äºå­˜æ”¾.tar.gzå‹ç¼©åŒ…ï¼Œ
        tar --exclude='.git' -czvf packages/"$REPO_FORMER"_${{ env.date2 }}.tar.gz "$REPO_FORMER"                      ## å‹ç¼©â€œformerâ€æ–‡ä»¶å¤¹ï¼ˆæ’é™¤.gitç›®å½•ï¼‰
        mv -f $REPO_BRANCH/Backups Backups                                                                             ## ç§»åŠ¨ ä»“åº“å‘å¸ƒèµ„äº§â€œBackupsâ€è‡³ packages ç›®å½•å†…
        tar --exclude='.git' -czvf packages/"$REPO_BRANCH"_${{ env.date2 }}.tar.gz "$REPO_BRANCH"                      ## å‹ç¼©â€œmainâ€  æ–‡ä»¶å¤¹ï¼ˆæ’é™¤.gitç›®å½•ï¼‰
        tar --exclude='.git' -czvf packages/Backups_${{ env.date2 }}.tar.gz Backups                                    ## å‹ç¼© ä»“åº“å‘å¸ƒèµ„äº§â€œBackupsâ€
        # cd packages
        echo "PACKAGES=$PWD" >> $GITHUB_ENV                                                                            ## åˆ—è¡¨å†™å…¥å˜é‡ä¸­
        
        
        if [ -e $GITHUB_WORKSPACE/LICENSE ]; then                                                                      ## åˆ¤æ–­ï¼å½“å·¥ä½œç›®å½•å†…æœ‰ LICENSE æ–‡ä»¶æ—¶ï¼Œå¤åˆ¶åˆ°  å·¥ä½œç›®å½•/mainç›®å½•å†…
          cp $GITHUB_WORKSPACE/LICENSE $GITHUB_WORKSPACE/$REPO_BRANCH
        fi
        
        if [ -e $GITHUB_WORKSPACE/README.md ]; then                                                                    ## åˆ¤æ–­ï¼ å½“æœ‰ README.md æ–‡ä»¶æ—¶ï¼Œå¤åˆ¶åˆ°mainç›®å½•å†…
          cp $GITHUB_WORKSPACE/README.md $GITHUB_WORKSPACE/$REPO_BRANCH
        fi
        
        
        
    - name: ä¸Šä¼ å…¨éƒ¨æºç                                                                            ## Upload bin directory
      uses: actions/upload-artifact@v4                                                             ## https://github.com/actions/upload-artifact
      with:
        name: ${{env.CangKu}}_${{ env.date2 }}         ## æ–‡ä»¶åç§°
        path: ${{ github.workspace }}                  ## å½“å‰ä»“åº“è¿è¡Œè·¯å¾„
        
        
        
    - name: æ¨é€ main åˆ†æ”¯                             ## Upload
      env: 
        ACCESS_TOKEN: ${{ secrets.ACCESS_TOKEN }}                                                  ## é¡¹ç›®ä»“åº“ä¸­æ·»åŠ ï¼šACCESS_TOKEN ä»¤ç‰Œå€¼
      run: |
        pwd && ls
        
        cd $GITHUB_WORKSPACE/$REPO_BRANCH                                                          ## è¿›å…¥åˆ°mainç›®å½•å†…
        
        if git status --porcelain | grep .; then                                                   ## åˆ¤æ–­ï¼ å½“æ’ä»¶æœ‰æ›´æ–°å·®å¼‚æ—¶ï¼Œæäº¤ï¼Œ
          git add .
          Emoji=("ğŸŒ¸" "ğŸŒ" "ğŸŒ¿" "â›…" "ğŸ‚" "ğŸ’¦" "ğŸ’¤" "ğŸ’­" "ğŸ­" "ğŸ‰" "ğŸ" "ğŸˆ" "ğŸ¾" "ğŸ¨" "ğŸ’‹" "ğŸ“" "ğŸ•" "ğŸ‰" "ğŸ™ˆ" "ğŸ¤¡" "ğŸ¡")              ## éšæœºè¡¨æƒ…
          git commit -am "${Emoji[$[$RANDOM % ${#Emoji[@]}]]} æ›´æ–°æ—¶é—´ $(date +%Y-%m-%d" "%H:%M:%S)"                                     ## æäº¤æ›´æ”¹ï¼Œæäº¤ä¿¡æ¯åŒ…å«éšæœºè¡¨æƒ…å’Œå½“å‰æ—¥æœŸæ—¶é—´
          git push --quiet "https://${{ secrets.ACCESS_TOKEN }}@github.com/$AUTHOR_ID/$CangKu_ID.git" HEAD:$REPO_BRANCH                   ## ä¸Šä¼ ä»“åº“çš„åœ°å€ï¼ˆæ–°åˆ›å»ºçš„ä»“åº“ï¼‰
          echo "push_main=true" >> $GITHUB_ENV                                                     ## å¦‚æœæœ‰   æ¨é€æ’ä»¶ï¼Œå†™å…¥å˜é‡çœŸ
        else
          echo "æ²¡æœ‰ä»€ä¹ˆå¯æäº¤çš„"                                                                 ## åä¹‹æç¤ºï¼š â€œæ²¡æœ‰ä»€ä¹ˆå¯æäº¤çš„â€
          echo "push_main=false" >> $GITHUB_ENV                                                    ## å¦‚æœæ²¡æœ‰ æ¨é€æ’ä»¶ï¼Œå†™å…¥å˜é‡å‡
          exit 0
        fi || exit 0
        
        
        
    - name: æ¨é€ former åˆ†æ”¯                           ## Upload
      env: 
        ACCESS_TOKEN: ${{ secrets.ACCESS_TOKEN }}                                                  ## é¡¹ç›®ä»“åº“ä¸­æ·»åŠ ï¼šACCESS_TOKEN ä»¤ç‰Œå€¼
      run: |
        
        cd $GITHUB_WORKSPACE/$REPO_FORMER                                                          ## è¿›å…¥åˆ°â€œformerâ€ç›®å½•å†…
        
        if git status --porcelain | grep .; then                                                   ## åˆ¤æ–­ï¼ å½“æ’ä»¶æœ‰æ›´æ–°å·®å¼‚æ—¶ï¼Œæäº¤ï¼Œ
          git add .
          Emoji=("ğŸŒ¸" "ğŸŒ" "ğŸŒ¿" "â›…" "ğŸ‚" "ğŸ’¦" "ğŸ’¤" "ğŸ’­" "ğŸ­" "ğŸ‰" "ğŸ" "ğŸˆ" "ğŸ¾" "ğŸ¨" "ğŸ’‹" "ğŸ“" "ğŸ•" "ğŸ‰" "ğŸ™ˆ" "ğŸ¤¡" "ğŸ¡")              ## éšæœºè¡¨æƒ…
          git commit -am "${Emoji[$[$RANDOM % ${#Emoji[@]}]]} æ›´æ–°æ—¶é—´ $(date +%Y-%m-%d" "%H:%M:%S)"                                     ## æäº¤æ›´æ”¹ï¼Œæäº¤ä¿¡æ¯åŒ…å«éšæœºè¡¨æƒ…å’Œå½“å‰æ—¥æœŸæ—¶é—´
          git push --quiet "https://${{ secrets.ACCESS_TOKEN }}@github.com/$AUTHOR_ID/$CangKu_ID.git" HEAD:$REPO_FORMER                   ## ä¸Šä¼ ä»“åº“çš„åœ°å€ï¼ˆæ–°åˆ›å»ºçš„ä»“åº“ï¼‰
          echo "push_former=true" >> $GITHUB_ENV                                                   ## å¦‚æœæœ‰   æ¨é€æ’ä»¶ï¼Œå†™å…¥å˜é‡çœŸ
        else
          echo "æ²¡æœ‰ä»€ä¹ˆå¯æäº¤çš„"                                                                 ## åä¹‹æç¤ºï¼š â€œæ²¡æœ‰ä»€ä¹ˆå¯æäº¤çš„â€
          echo "push_former=false" >> $GITHUB_ENV                                                  ## å¦‚æœæ²¡æœ‰ æ¨é€æ’ä»¶ï¼Œå†™å…¥å˜é‡å‡
          exit 0
        fi || exit 0
        
        
        
    - name: å‘å¸ƒå›ºä»¶
      uses: softprops/action-gh-release@v2
      if: github.event.inputs.release == 'true' && (env.push_main == 'true' || env.push_former == 'true')
      env:
        GITHUB_TOKEN: ${{ secrets.ACCESS_TOKEN }}
      with:
        name: ${{ env.date1 }} ã€Œ è½¯ä»¶å·¥å…· ã€#${{env.Run_number}}
        tag_name: "${{ env.date }}"
        body: |
            â˜†  å¸¸ç”¨æ’ä»¶
            -
            â˜†  å·²ç»åˆ åº“ç•™å­˜æºç 
        files: ${{ env.PACKAGES }}/packages/*
        
        
        
    - name: åˆ é™¤å·¥ä½œæµç¨‹è¿è¡Œ      ## Delete workflow runs
      uses: Mattraks/delete-workflow-runs@v2
      with:
        token: ${{ secrets.ACCESS_TOKEN }}
        repository: ${{ github.repository }}
        retain_days: 1
        keep_minimum_runs: 2
        
        
        
    - name: åˆ é™¤æ—§å‘å¸ƒç‰ˆæœ¬            ## Remove old Releases
      uses: dev-drprasad/delete-older-releases@v0.3.4          ## https://github.com/dev-drprasad/delete-older-releases
      if: github.event.inputs.release == 'true' && (env.push_main == 'true' || env.push_former == 'true')
      with:
        keep_latest: 30            ## ä¿ç•™æœ€å°‘æ•°ï¼ˆé»˜è®¤å€¼ï¼š3ï¼‰
        delete_tags: true
      env:
        GITHUB_TOKEN: ${{ secrets.ACCESS_TOKEN }}
        
        
        
    - name: è®¡ç®—æ€»è¿è¡Œæ—¶é•¿
      run : |
        # è®¡ç®—è¿è¡Œæ—¶é•¿å¿…è¦çš„ä¾èµ–å·¥å…·ï¼ˆbc awkï¼‰
        
        echo "$(date +%s)" > end_time.txt                                                           ## ç»“æŸæ—¶é—´ å†™å…¥åˆ°â€œend_time.txtâ€æ–‡æœ¬ä¸­ï¼ˆä¸å¼€å¤´â€œstart_time.txtâ€æ–‡æœ¬å¯¹åº”ï¼‰
        ELAPSED_MINUTES=$(awk -v start=$(cat start_time.txt) -v end=$(cat end_time.txt) 'BEGIN { elapsed = end - start; printf "%.2f", elapsed / 60 }')         ## = ELAPSED_MINUTESå˜é‡ï¼šè®¡ç®—è¿è¡Œæ—¶é—´ï¼Œå¹¶ä¿ç•™ä¸¤ä½å°æ•°ç‚¹å’Œä¿ç•™å‰é¢æœ‰0
        echo "ELAPSED_MINUTES=$ELAPSED_MINUTES" >> $GITHUB_ENV                                                                                                  ## æ€»è¿è¡Œæ—¶é—´ï¼ˆåˆ†é’Ÿï¼‰å†™å…¥å˜é‡ï¼š ELAPSED_MINUTES    ELAPSED_TIME
        rm -rf {start_time.txt,end_time.txt}
        
        
        
    - name: ç»“æŸ_pushpluså¾®ä¿¡é€šçŸ¥       ## Githubè®¾ç½®é‡Œéœ€æ·»å¾®ä¿¡SCKEY=PUSHPLUSå€¼
      uses: xhnmt/pushplus-action@v1.0.0
      with:
        token: ${{ secrets.SCKEY }}
        title: "æ›´æ–°æ’ä»¶_${{env.CangKu}}_#${{env.Run_number}}"
        content: "
              
              ä»“åº“åç§°ï¼š${{env.CangKu}}
              
              
              å·¥ä½œæµå·ï¼š#${{env.Run_number}}
              
              
              å¯åŠ¨æ—¶é—´ï¼š${{ env.date1 }}
              
              
              è¿è¡Œæ—¶é—´ï¼šå…¨ç¨‹ç”¨æ—¶ ${{ env.ELAPSED_MINUTES }} åˆ†é’Ÿ
              
              
              "
              ## ç»“å°¾
              
              